class e{constructor(e,s,t){this.screenPos=e,this.mapPos=s,this.map=t,console.log(`screen: [${this.screenPos.x},${this.screenPos.y}} - map:[${this.mapPos.x},${this.mapPos.y}]`)}render(){const{x:e,y:s}=this.screenPos,{x:t,y:i}=this.map.getTilePos(this.screenPos),{context:n,tile:{width:o,height:h,color:r}}=this.map,a=e-o/2,l=s+h/2;n.beginPath(),n.moveTo(a,s),n.lineTo(t,l),n.lineTo(a,i),n.lineTo(e,l),n.lineTo(a,s),n.stroke(),n.fillStyle=r,n.fill(),n.fillStyle="black",n.fillText(`${this.mapPos.x},${this.mapPos.y}`,e-40,s+20)}}class s{constructor(e,s){this.screenPos=e,this.map=s,console.log("prism",e)}render(){const{x:e,y:s}=this.screenPos,{context:t,tile:{width:i,height:n,color:o}}=this.map;t.beginPath(),t.moveTo(e-i/2,s-n),t.lineTo(e-i,s-n/2),t.lineTo(e-i/2,s),t.lineTo(e,s-n/2),t.lineTo(e-i/2,s-n),t.fillStyle="#555555",t.fill(),t.beginPath(),t.moveTo(e-i,s-n/2),t.lineTo(e-i,s+n/2),t.lineTo(e-i/2,s+n),t.lineTo(e-i/2,s),t.lineTo(e-i,s-n/2),t.fillStyle="#444444",t.fill(),t.beginPath(),t.moveTo(e-i/2,s),t.lineTo(e,s-n/2),t.lineTo(e,s+n/2),t.lineTo(e-i/2,s+n),t.lineTo(e-i/2,s),t.fillStyle="#777777",t.fill()}}class t{constructor(e,s){this.value=e,this.isDown=!1,this.isUp=!0;const t=e=>{e.key===this.value&&(this.isUp&&this.press&&this.press(),this.isDown=!0,this.isUp=!1,e.preventDefault())},i=e=>{e.key===this.value&&(this.isDown&&this.release&&this.release(),this.isDown=!1,this.isUp=!0,e.preventDefault())};s.addEventListener("keydown",t,!1),s.addEventListener("keyup",i,!1),this.unsubscribe=()=>{s.removeEventListener("keydown",t,!1),s.removeEventListener("keyup",i,!1)}}}class i{constructor(e){const s=e=>{this.press&&this.press(e),e.preventDefault()},t=e=>{this.up&&this.up(e),e.preventDefault()},i=e=>{this.move&&this.move(e),e.preventDefault()};e.addEventListener("mousedown",s,!1),e.addEventListener("mouseup",t,!1),e.addEventListener("mousemove",i,!1),this.unsubscribe=()=>{e.removeEventListener("mousedown",s,!1),e.removeEventListener("mouseup",t,!1),e.removeEventListener("mousemove",i,!1)}}}const n=(e,s=document)=>new t(e,s);const o=new class{constructor(s){this.screenPos={x:0,y:0},this.renderLayers=[[],[]],this.images=new Map,this.clear=()=>this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this._addTile=(s,t=0)=>{const i=this.convertIsoToScreen(s),n=new e(i,s,this);return this.renderLayers[t].push(n),n},this._sortLayer=e=>this.renderLayers[e].sort(((e,s)=>{const t=e.screenPos.y-s.screenPos.y;return 0===t?s.screenPos.x-e.screenPos.x:t})),this.addEntity=(e,s=1)=>{const t=this.convertScreenToIso(e.screenPos);return!!this.isOnMap(t)&&(this.renderLayers[s].push(e),!0)},this.convertIsoToScreen=e=>({x:(e.x-e.y)*this.tile.width/2+this.mapPos.x,y:(e.x+e.y)*this.tile.height/2+this.mapPos.y}),this.getTilePos=e=>({x:e.x-this.tile.width,y:e.y+this.tile.height}),this.isOnMap=e=>e.x>=0&&e.x<this.mapSize.width&&e.y>=0&&e.y<this.mapSize.height;const t=document.getElementById(s.canvasId??"canvas");if(null==t)throw new Error("canvas is null!");const i=t.getContext("2d");if(null==i)throw new Error("2d context from canvas is null!");this._canvas=t,this.context=i,this.screenSize={width:s.screen.width,height:s.screen.height},this.mapSize={width:s.mapSize.width,height:s.mapSize.height},this.tile={width:s.tileSize.width,height:s.tileSize.height,color:s.color??"#15B89A"},this.mapPos={x:this.screenSize.width/2,y:2*this.tile.height}}get canvas(){return this._canvas}create(){this._canvas.setAttribute("width",`${this.screenSize.width}`),this._canvas.setAttribute("height",`${this.screenSize.height}`);for(let e=0;e<this.mapSize.width;e++)for(let s=0;s<this.mapSize.height;s++)this._addTile({x:e,y:s});this.gameLoopItnterval=setInterval((()=>this.render()),500)}render(){this.clear(),this.renderLayers[0].forEach((e=>e.render())),this._sortLayer(1),this.renderLayers[1].forEach((e=>e.render()))}convertScreenToIso(e){const s=(e.x-this.mapPos.x)/this.tile.width,t=(e.y-this.mapPos.y)/this.tile.height;return{x:Math.floor(t+s),y:Math.floor(t-s)}}loadImages(...e){e.forEach((e=>{const s=(e=>{const s=e.split("/");if(s.length>0){const e=s[s.length-1],t=/(.+)[.](.+)$/.exec(e);if(null!=t)return t[1]}})(e);if(s){let t=new Image;t.src=e,t.onload=t=>{console.log(`image ${s} from path: ${e} loaded`,t)},this.images.set(s,t)}else console.warn(`image path: ${e} is not valid!`)}))}renderImage(e,s){const t=this.images.get(e);if(t){const{x:e,y:i}=this.getTilePos(s);this.context.drawImage(t,e,i-t.naturalHeight)}}}({screen:{width:1024,height:800},mapSize:{width:14,height:14},tileSize:{width:64,height:32}});o.create(),o.loadImages("assets/man-ne.png","assets/man-nw.png","assets/man-se.png"," assets/man-sw.png");let h=n("ArrowLeft"),r=n("ArrowUp"),a=n("ArrowRight"),l=n("ArrowDown");((e=document.body)=>new i(e))().press=e=>{let t=function(e){const s=e.target;if(null==s)return null;const t=s.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}(e);null!=t&&(t=o.convertScreenToIso(t),o.addEntity(new s(o.convertIsoToScreen(t),o)))};const c=new class{constructor(e,s){this.mapPos=e,this.map=s,this.move="none",this.currentImage="man-se",this.screenPos=s.convertIsoToScreen(e)}render(){switch(this.move){case"down":this.map.isOnMap({x:this.mapPos.x+1,y:this.mapPos.y})&&(this.mapPos.x+=1,this.currentImage="man-se");break;case"left":this.map.isOnMap({x:this.mapPos.x,y:this.mapPos.y+1})&&(this.mapPos.y+=1,this.currentImage="man-sw");break;case"right":this.map.isOnMap({x:this.mapPos.x,y:this.mapPos.y-1})&&(this.mapPos.y-=1,this.currentImage="man-ne");break;case"up":this.map.isOnMap({x:this.mapPos.x-1,y:this.mapPos.y})&&(this.mapPos.x-=1,this.currentImage="man-nw")}this.screenPos=this.map.convertIsoToScreen(this.mapPos),this.map.renderImage(this.currentImage,this.screenPos)}}({x:1,y:1},o);o.addEntity(c),h.press=()=>{c.move="left"},h.release=()=>{c.move="none"},a.press=()=>{c.move="right"},a.release=()=>{c.move="none"},r.press=()=>{c.move="up"},r.release=()=>{c.move="none"},l.press=()=>{c.move="down"},l.release=()=>{c.move="none"};
//# sourceMappingURL=index.1425f434.js.map
